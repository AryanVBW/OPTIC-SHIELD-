# OPTIC-SHIELD Configuration
# Base configuration file - overridden by environment-specific configs

# Environment: development | production
# Set via OPTIC_ENV environment variable
environment: development

# Device identification
device:
  id: ""  # Auto-generated if empty
  name: "optic-shield-001"
  location:
    name: "Unknown Location"
    latitude: 0.0
    longitude: 0.0

# Detection settings
detection:
  model:
    path: "models/yolo11n_ncnn_model"
    fallback_path: "models/yolo11n.pt"
    confidence_threshold: 0.5
    iou_threshold: 0.45
    max_detections: 10
  
  # Target classes (Wild cats / Big cats only)
  # 15: tiger, 16: leopard, 17: jaguar, 18: lion, 19: cheetah
  # 20: snow leopard, 21: clouded leopard, 22: puma, 23: lynx
  target_classes: [15, 16, 17, 18, 19, 20, 21, 22, 23]
  
  # Processing settings
  input_size: 640
  batch_size: 1
  
  # Performance optimization
  use_ncnn: true
  num_threads: 4

# Camera settings
camera:
  enabled: true
  resolution:
    width: 640
    height: 480
  format: "RGB888"
  fps: 10
  rotation: 0
  
  # Fallback to USB camera if Pi Camera fails
  fallback_usb: true
  usb_device_id: 0

# Storage settings
storage:
  database:
    path: "data/detections.db"
    max_size_mb: 500
  
  images:
    path: "data/images"
    save_detections: true
    jpeg_quality: 85
    max_storage_mb: 2000
    cleanup_days: 30
  
  logs:
    path: "logs"
    max_size_mb: 100
    retention_days: 7

# Alert settings
alerts:
  enabled: true
  
  # Minimum time between alerts for same class (seconds)
  cooldown_seconds: 60
  
  # Local alerts
  local:
    gpio_enabled: false
    gpio_pin: 17
    buzzer_duration_ms: 500
  
  # Remote alerts (via dashboard API)
  remote:
    enabled: true
    include_image: true
    image_max_size_kb: 100
    retry_attempts: 3
    retry_delay_seconds: 5

# Dashboard API connection
dashboard:
  # API endpoint (set in environment-specific config)
  api_url: ""
  api_key: ""
  
  # WebSocket for real-time updates
  websocket_enabled: true
  websocket_url: ""
  
  # Sync settings
  sync_interval_seconds: 300
  heartbeat_interval_seconds: 60
  
  # Offline queue
  offline_queue_max_size: 1000

# System settings
system:
  # Watchdog - restart service if unresponsive
  watchdog:
    enabled: true
    timeout_seconds: 30
  
  # Auto-restart on crash
  auto_restart: true
  max_restart_attempts: 5
  restart_delay_seconds: 10
  
  # Resource limits
  max_memory_mb: 512
  max_cpu_percent: 80
  
  # Graceful shutdown timeout
  shutdown_timeout_seconds: 10

# Logging
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  console: true
  file: true
  file_path: "logs/optic-shield.log"

# Hardware monitoring (Raspberry Pi specific)
hardware_monitoring:
  enabled: true
  interval_seconds: 5
  history_hours: 24
  alert_thresholds:
    cpu_temp_celsius: 75
    gpu_temp_celsius: 70
    cpu_throttling: true
    undervoltage: true
    low_voltage_v: 4.75
    high_memory_percent: 85
    high_swap_percent: 80
    low_storage_mb: 1000
    high_cpu_percent: 90

# Crash handling and recovery
crash_handling:
  enabled: true
  watchdog_enabled: true
  watchdog_timeout_seconds: 30
  crash_reports_enabled: true
  crash_reports_upload: true
  emergency_fallback_mode: true

# Detection automation
detection_automation:
  enabled: true
  
  # Priority class mappings
  # Critical: Immediate threat animals (bears, elephants, tigers, lions)
  # High: Dangerous predators (leopards, wolves, wild boar)
  # Medium: Large herbivores (deer, wild pigs, monkeys)
  # Low: Small animals
  priority_classes:
    critical: [15, 16, 17, 18, 19, 83, 84, 85]  # Tigers, lions, bears, elephants
    high: [20, 21, 22, 86, 87]  # Leopards, jaguars, wolves
    medium: [88, 89, 90]  # Deer, monkeys, wild pigs
    low: [91, 92]  # Small animals
  
  # Automated actions on detection
  automated_actions:
    capture_burst_photos: true
    burst_count: 5
    record_video: true
    video_duration_seconds: 10
    gps_tagging: true
    sound_alert: false
  
  # Upload scheduling rules
  upload_rules:
    critical_immediate: true  # Upload critical detections immediately
    high_delay_seconds: 60  # Upload high priority within 1 minute
    medium_batch_minutes: 5  # Batch upload medium priority every 5 minutes
    low_daily_summary: true  # Daily summary for low priority

