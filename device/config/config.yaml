# OPTIC-SHIELD Configuration
# Base configuration file - overridden by environment-specific configs

# Environment: development | production
# Set via OPTIC_ENV environment variable
environment: development

# Device identification
device:
  id: ""  # Auto-generated if empty
  name: "MAC_BOOK"
  location:
    name: "kawathe(yemai)"
    latitude: 19.2122
    longitude: 72.9222

# Detection settings
detection:
  model:
    path: "models/yolo11n_ncnn_model"
    fallback_path: "models/yolo11n.pt"
    confidence_threshold: 0.5
    iou_threshold: 0.45
    max_detections: 10
  
  # Target classes (Wild cats / Big cats only)
  # 15: tiger, 16: leopard, 17: jaguar, 18: lion, 19: cheetah
  # 20: snow leopard, 21: clouded leopard, 22: puma, 23: lynx
  target_classes: [15, 16, 17, 18, 19, 20, 21, 22, 23]
  
  # Processing settings
  input_size: 640
  batch_size: 1
  
  # Performance optimization
  use_ncnn: true
  num_threads: 4

# Camera settings
camera:
  enabled: true
  resolution:
    width: 640
    height: 480
  format: "RGB888"
  fps: 10
  rotation: 0
  
  # Fallback to USB camera if Pi Camera fails
  fallback_usb: true
  usb_device_id: 0

# Storage settings
storage:
  database:
    path: "data/detections.db"
    max_size_mb: 500
  
  images:
    path: "data/images"
    save_detections: true
    jpeg_quality: 85
    max_storage_mb: 2000
    cleanup_days: 30
  
  logs:
    path: "logs"
    max_size_mb: 100
    retention_days: 7

# Alert settings
alerts:
  enabled: true
  
  # Minimum time between alerts for same class (seconds)
  cooldown_seconds: 60
  
  # Local alerts
  local:
    gpio_enabled: false
    gpio_pin: 17
    buzzer_duration_ms: 500
  
  # Remote alerts (via dashboard API)
  remote:
    enabled: true
    include_image: true
    image_max_size_kb: 100
    retry_attempts: 3
    retry_delay_seconds: 5

# Dashboard API connection
dashboard:
  # API endpoint (set in environment-specific config)
  api_url: ""
  api_key: ""
  
  # WebSocket for real-time updates
  websocket_enabled: true
  websocket_url: ""
  
  # Sync settings
  sync_interval_seconds: 300
  heartbeat_interval_seconds: 60
  
  # Offline queue
  offline_queue_max_size: 1000

# Guaranteed Delivery Settings (Production-grade message broker)
delivery:
  enabled: true
  
  # Delivery interval in seconds
  interval_seconds: 5
  
  # Batch size for processing
  batch_size: 10
  
  # Maximum queue size before eviction
  max_queue_size: 50000
  
  # Maximum in-flight messages
  max_in_flight: 100
  
  # Visibility timeout for in-flight messages (seconds)
  visibility_timeout_seconds: 300
  
  # Retry settings
  max_retry_attempts: 10
  retry_backoff_base_seconds: 30
  retry_backoff_max_seconds: 3600
  
  # Message TTL (7 days default)
  message_ttl_seconds: 604800
  
  # Circuit breaker settings
  circuit_breaker:
    failure_threshold: 5
    recovery_timeout_seconds: 60
    half_open_max_calls: 3
  
  # Deduplication
  enable_deduplication: true
  dedup_window_seconds: 300

# Location/GPS Settings
location:
  # GPS serial port (leave empty to disable GPS)
  gps_port: ""
  gps_baudrate: 9600
  
  # Update interval for GPS readings
  update_interval_seconds: 10
  
  # Cache location to file for persistence
  cache_enabled: true

# Health Monitoring
health:
  enabled: true
  
  # Health check interval
  check_interval_seconds: 30
  
  # Alert cooldown to prevent spam
  alert_cooldown_seconds: 300
  
  # Self-healing settings
  self_healing_enabled: true
  
  # Resource thresholds
  cpu_warning_percent: 80
  cpu_critical_percent: 95
  memory_warning_percent: 80
  memory_critical_percent: 95
  disk_warning_percent: 80
  disk_critical_percent: 95
  temperature_warning_celsius: 70
  temperature_critical_celsius: 85

# System settings
system:
  # Watchdog - restart service if unresponsive
  watchdog:
    enabled: true
    timeout_seconds: 30
  
  # Auto-restart on crash
  auto_restart: true
  max_restart_attempts: 5
  restart_delay_seconds: 10
  
  # Resource limits
  max_memory_mb: 512
  max_cpu_percent: 80
  
  # Graceful shutdown timeout
  shutdown_timeout_seconds: 10

# Automatic Updates
updates:
  enabled: true
  
  # Git remote and branch to pull from
  remote: "origin"
  branch: "main"
  
  # Check interval in seconds (default: 1 hour)
  check_interval_seconds: 3600
  
  # Auto-apply updates without manual trigger
  auto_update: false
  
  # Service name for restart
  service_name: "optic-shield"
  
  # Notify portal of update status
  report_to_portal: true

# Logging
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  console: true
  file: true
  file_path: "logs/optic-shield.log"
